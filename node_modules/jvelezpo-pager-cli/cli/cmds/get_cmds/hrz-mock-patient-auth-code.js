'use strict';

const JWT = require('jsonwebtoken');
const { v4: uuidv4 } = require('uuid');

exports.command = 'hrz-auth-code [first-name] [last-name] [private-key]';

exports.desc = 'Horizon Mock Patient Auth code generator';

exports.builder = {
    'first-name': {
        required: true
    },
    'last-name': {
        required: true
    },
    'private-key': {
        required: true
    }
};

exports.handler = function (argv) {

    const { firstName, lastName, privateKey } = argv;
    const sub = uuidv4();
    const aud = 'mock.pager.dev';
    const user = 'PAGER-MOCK-PATIENT';

    const payload = {
        sub,
        firstName,
        lastName,
        user,
        aud
    };

    const authcode = JWT.sign(payload, privateKey, { algorithm: 'HS256', keyid: 'abc123' });

    console.log('AuthCode:\n', authcode);

};
