'use strict';

const { getDeployShaTable } = require('../../../scripts/utils/deploy-shas');
const { convertArrayToCSV } = require('convert-array-to-csv');
const { spawn } = require('child_process');
const moment = require('moment');

exports.command = 'deploy-shas [convert-to-csv]';

exports.desc = 'Table view of shas deployed across Pager stack';

exports.builder = {
    'convert-to-csv': {
        alias: 'ctc'
    },
    'row-filter': {
    },
    'column-filter': {
    }
};

exports.handler = async function handler(argv) {

    const output = await getDeployShaTable(argv);
    if (argv['convert-to-csv']) {
        const data = convertArrayToCSV(output);
        spawn(`echo "${data}" > ./data/deploy-shas/deploy-sha-data-${moment().format()}.csv`, { shell: true, stdio: 'inherit' });
    }
};
